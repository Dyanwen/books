# 12 | 延迟解析：V8是如何实现闭包的？

在编译js代码的时候,v8并不会一次性将所有的js解析为中间代码,这主要是基于以下两点:
- 如果一次编译所有的代码,会增加编译时间,这会严重影响到首次执行js代码的速度,让用户感觉到卡顿,
- 解析完成的字节码和编译之后的机器代码都会存在内存中,如果一次性解析和编译完成,那么中间代码和机器代码将会一直占用内存

因此,所有的js虚拟机都实现了惰性解析,所谓的惰性解析是指解析器在解析的过程中,如果遇到函数声明,那么会跳过函数内部的代码,并不会为其生成ast和字节码,而仅仅生成顶层代码的ast和字节码

## 闭包的三个特性
1. js允许在函数内部定义新的函数
2. 可以在内部函数中访问父函数中定义的变量
3. 函数可以作为另一个函数的返回值


v8还提供了另一个功能,就是函数的预解析.
在预解析的时候检查语法错误,见擦函数内部是否引用了外部变量,如果引用了外部变量,预解析器会将栈中的变量复制到堆中,在下次执行到该函数的时候,直接使用堆中的引用,这样就解决了闭包带来的问题
