# 03｜快属性和慢属性：V8采用了哪些策略提升了对象属性的访问速度？

js中的对象是由一组组属性和值的集合,从js语言的角度来看,js对象像一个字典,字符串作为键名,任意对象可以作为键值,可以通过键名读取键值  

然而在V8实现对象存储时,并没有完全采用字段的存储方式,这主要是出于性能的考量,因为字典是非线性的数据结构,查询效率会低于线性的数据结构,V8为了提升存储和查找效率,采用了一套复杂的存储策略

```js
function Foo(property_num,element_num){
    for(let i = 0;i<element_num;i++){
        this[i] = `element${i}`
    }
    for(let i = 0;i<property_num;i++){
        let ppt = `property${i}`;
        this[ppt]=ppt;
    }
}
var bar = new Foo(10,10);
```

- 因为js中的对象是由一组组属性和值组成的,所以最简单的方式是使用一个字典来保存属性和值,但是由于字典是非线性结构,所以使用如果使用字典,读取效率会大大降低
- 为了提升查找效率,V8在对象中添加了两个隐藏属性,排序属性和常规属性,指向了elements对象,在elements对象中,会按照顺序存放排序属性.properties属性则指向了properties对象,在properties对象中,会按照创建时的顺序保存常规属性

通过引入这两个属性,加速了V8查找属性的速度,为了更快进一步提升查找效率,V8还实现了内置内属性的策略,当常规属性少于一定数量时,V8就会将这些常规属性直接写进对象中,这样又节省了一个中间步骤

但是如果对象中的属性过多时,或者存在反复田间或者删除属性的操作,那么V8就会将线性的存储模式降级为非线性的字典存储模式,这样虽然降低了查找速度,但是却提升了修改对象的属性的速度.


